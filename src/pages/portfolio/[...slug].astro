---
import { formatDate, createSlug } from "../../lib/utils";
import Prose from "../../components/prose.astro";
import { getCollection, render } from "astro:content";
import InfoLayout from "../../layouts/InfoLayout.astro";

export const prerender = true;

export async function getStaticPaths() {
    const articles = await getCollection("articles");

    return articles.map((article) => ({
        params: {
            slug: createSlug(article.data.title)
        },
        props: { article },
    }));
}

const { article } = Astro.props;

if (article === undefined) {
    return new Response("Article not found", { status: 404 });
}

const { Content } = await render(article);

const allArticles = await getCollection("articles");

const relatedArticles = allArticles.filter(
    (relatedArticle) =>
        relatedArticle.data.category === article.data.category &&
        relatedArticle.id !== article.id,
);
---

<InfoLayout title={article.data.title} frontmatter={article.data}>
    <section >
        <Prose>
            <h1>{ article.data.title }</h1>
            <Content />
        </Prose>
    </section>
</InfoLayout>
